---
title: P3092题解
date: 2023-01-20 20:52:53
tags:
- 状压DP
- 二分
categories: 题解
url: solution-P3092
---

# [USACO13NOV]No Change G

## 题目描述

Farmer John is at the market to purchase supplies for his farm.  He has in his pocket $K$ coins ($1\leq K \leq16$), each with value in the range $1\cdots100,000,000$.  FJ would like to make a sequence of $N$ purchases ($1\leq N\leq100,000$), where the ith purchase costs $c(i)$ units of money ($1\leq c(i)\leq10,000$).  As he makes this sequence of purchases, he can periodically stop and pay, with a single coin, for all the purchases made since his last payment (of course, the single coin he uses must be large enough to pay for all of these).  Unfortunately, the vendors at the market are completely out of change, so whenever FJ uses a coin that is larger than the amount of money he owes, he sadly receives no changes in return!

Please compute the maximum amount of money FJ can end up with after making his $N$ purchases in sequence.  Output $-1$ if it is impossible for FJ to make all of his purchases.

约翰到商场购物，他的钱包里有 $K(1\leq K\leq16)$ 个硬币，面值的范围是 $1\cdots100,000,000$。

约翰想按顺序买 $N$ 个物品($1\leq N\leq100,000$)，第$i$个物品需要花费 $c(i)$ 块钱，($1\leq c(i)\leq10,000$)。

在依次进行的购买 $N$ 个物品的过程中，约翰可以随时停下来付款，每次付款只用一个硬币，支付购买的内容是从上一次支付后开始到现在的这些所有物品（前提是该硬币足以支付这些物品的费用）。不幸的是，商场的收银机坏了，如果约翰支付的硬币面值大于所需的费用，他不会得到任何找零。

请计算出在购买完 $N$ 个物品后，约翰最多剩下多少钱。如果无法完成购买，输出 $-1$

## 输入格式

\* Line $1$: Two integers, $K$ and $N$.

\* Lines $2\cdots1+K$: Each line contains the amount of money of one of FJ's coins.

\* Lines $2+K\cdots1+N+K$: These $N$ lines contain the costs of FJ's intended purchases.

## 输出格式

\* Line $1$: The maximum amount of money FJ can end up with, or $-1$ if FJ cannot complete all of his purchases.

## 样例 #1

### 样例输入 #1

```in
3 6 
12 
15 
10 
6 
3 
3 
2 
3 
7
```

### 样例输出 #1

```out
12
```

## 提示

FJ has $3$ coins of values $12$, $15$, and $10$.  He must make purchases in sequence of value $6$, $3$, $3$, $2$, $3$, and $7$.

FJ spends his $10$-unit coin on the first two purchases, then the $15$-unit coin on the remaining purchases.  This leaves him with the $12$-unit coin.

---

# 题解

强迫症上线，一定要标准的 $\LaTeX$！

由于当前的状态一定由上一个状态转移过来，所以显然，这是一道DP题。

我们用数组 `dp[i]` 表示状态 $i$ 下的硬币可以买到第几个商品，用数组 `f[i]` 表示状态 $i$ 下的花费。

注意，每次只能支付一枚硬币。

外层枚举状态，内层 $j$ 枚举 $16$ 位二进制数的每一位，若当前状态的第 $j$ 位为 $1$，那么可以考虑转移。

因为一种状态可以被多次更新，所以要取最大值，令 `dp` 数组存储的是当前最大编号。

如果到第 $N$ 件都可以购买，用 `ans` 记录当前的最小花费就可以得到答案。

对于记录当前状态下能达到的金钱数，我们可以用前缀和来记录。

除此之外 $i$，由于前缀和是单调的，我们设函数 `find(x)` 表示价值为 $x$ 的货币可以从 $1$ 连续购买到的最大商品的下标，可以用二分快速查找。

代码如下：

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

const int maxn=100005;
ll dp[maxn],sum[maxn],coin[20],c[maxn],K,N,ans=-1,pay[maxn];

int find(int x)
{
	int l=1,r=N,pos;
	while(l<=r)
	{
		int mid=((l+r)>>1);
		if(sum[mid]<=x) l=mid+1,pos=mid;
		else r=mid-1;
	}
	return pos;
}

signed main()
{
	cin>>K>>N;
	for(int i=0;i<K;++i) cin>>coin[i];
	for(int i=1;i<=N;i++) cin>>pay[i],sum[i]=sum[i-1]+pay[i];
	for(int sta=0;sta<(1<<K);++sta)//枚举状态
	{
		for(int i=0;i<K;i++)
		{
			if(!(sta&(1<<i))) continue;//当前硬币没被选过
			ll res=dp[sta^(1<<i)];
            //sta^(1<<i)表示当前状态去掉ci货币后的新状态，res表示新状态可以到达的最末商品
			ll pos=find(sum[res]+coin[i]);
			dp[sta]=max(dp[sta],pos);
		}
	}
	for(int sta=0;sta<(1<<K);++sta)
	{
		if(dp[sta]==N)
		{
			ll cnt=0;
			for(int j=0;j<K;++j)
				if(!(sta&(1<<j))) cnt+=coin[j];//如果当前位置没有货币，统计答案
			ans=max(ans,cnt);
		}
	}
	cout<<ans;
	return 0;
}
```

